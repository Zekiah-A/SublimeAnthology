<!DOCTYPE html>
<html>
<head>
    <title>Subliminal</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../styles.css">
    <script type="text/javascript">
    
    async function getComments() {
        var res = await fetch("https://subliminal-comments.ddns.net");

        var textContent = await res.text();
        document.getElementById("comments").innerHTML = textContent;
    
        setTimeout(getComments, 2000);
    }

    async function postComment() {
        var inputName = document.getElementById("name").value;
        var inputEmail = document.getElementById("email").value;
        var inputMessage = document.getElementById("input-contents").value;
        document.getElementById("input-contents").value = "";

        var commentObject = {name: inputName, email: inputEmail, message: inputMessage};
        await fetch("https://subliminal-comments.ddns.net", { method: "POST", body: JSON.stringify(commentObject)}); //var res
    }

    function onNameInput(input) {
        if (input.length > 16) {
            document.getElementById("nameLabel").textContent = `(name too long by ${input.length - 16}, end may be cut off)`;
        }
        else {
            document.getElementById("nameLabel").textContent = "";
        }
    }

    function onPostInput(input)
    {
        if (input.length <= 2) {
            document.getElementById("input-contents").style.color = "grey";
        }
        else if (input.length > 4096) {
            document.getElementById("input-contents").style.color = "grey";
        }
        else {
            document.getElementById("input-contents").style.color = "inherit";
        }
    }
    </script>
</head>
 
<body onload="getComments()">
    <div class="title-blur" style="z-index: 2;">
        <h2 class="centre content">Comments and Complaints</h2>
        <hr>
    </div>
    <div class="div-centre">
        <p>Here you post anything from coping rants due to not being cool enough for the anthology, to discussing the poems on the anthology and collaborating on new poem ideas. Regardless of that you put here, as long as it's not illegal, it's cool!</p>
        <em>Name(optional):</em>
        <input oninput="onNameInput(value)" type="text" id="name">
        <span id="nameLabel" style="color: grey;"></span> <br>
        <em>Email(optional):</em>
        <input oninput="onEmailInput(value)" type="text" id="email"> <br>
        <textarea oninput="onPostInput(value)" rows="5" cols="50" style="margin-top: 5px;" class="comment" id="input-contents"></textarea> <br>
        <button onclick="postComment()">Post</button>

        <div id="comments">
            <div class="comment">
                <em title="">Subliminal Dev Team said:</em>
                <em class="comment-date"></em>
                <p>If you can see this, then comments are currently down.</p>
            </div>
        </div>
    </div>
    <a href="../contents.html" class="back"> <- Back</a>
</body>
 
</html>
