<!DOCTYPE html>
<html>
<head>
    <title>Subliminal</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../styles.css">
    <script type="text/javascript">
        async function getPoem() {
            var result = await fetch("http://localhost:8000"/*"https://subliminal-comments.ddns.net/one-line-poem"*/);
            
            var textContent = await result.text();
            document.getElementById("content").innerHTML = textContent;
        
            setTimeout(getPoem, 2000);
        }

        async function postLine() {
            var inputName = document.getElementById("name").value;
            var inputLine = document.getElementById("poem-line").value;
            document.getElementById("name").value = "";
            document.getElementById("poem-line").value = "";

            var commentObject = {name: inputName, line: inputLine};
            let response = await fetch("http://localhost:8000"/*"https://subliminal-comments.ddns.net/one-line-poem"*/, { method: "POST", body: JSON.stringify(commentObject)});
            if (response.status == 200) {
                document.getElementById("status-label").textContent = "Sucessfully contributed line to the poem! You must wait until someone else has posted before you can add another.";
                document.getElementById("status-label").style.color = "green";
            }
            else if (response.status == 401) {
                document.getElementById("status-label").textContent = "Failed to post line to poem. You must wait until someone else has posted before you can add another.";
                document.getElementById("status-label").style.color = "red";
            }
            else if (response.status == 422) {
                document.getElementById("status-label").textContent = "Failed to post line to poem. Poem line was too short, or server detected it as spam :(.";
                document.getElementById("status-label").style.color = "red";
            }
            else {
                document.getElementById("status-label").textContent = "Failed to post line to poem. Network error likely encountered: " + response.status;
                document.getElementById("status-label").style.color = "red";
            }
        }

        function onNameInput(input) {
            if (input.length > 8) {
                document.getElementById("name").style.color = "grey";
            }
            else {
                document.getElementById("name").style.color = "inherit";
            }
        }

        function onPoemLineInput(input) {
            if (input.length > 154 || input.length <= 8) { //Amount of characters to fill a line with the thinnest character in the english alphabet (i)
                document.getElementById("poem-line").style.color = "grey";
            }
            else {
                document.getElementById("poem-line").style.color = "inherit";
            }
        }
    </script>
</head>
 
<body onload="getPoem()">
    <div class="title-blur">
        <h2 class="centre content"> One line at a time poem - By Everyone </h2>
        <hr>
    </div>
    <div class="div-centre">
        <p>On this page, you can help build the most epic poem ever, by writing the whatever you see fit as the next line in this massive poem created by the community. Be careful though, as you can only post <strong>one</strong>  line at a time!</p>
    </div>
    <div class="poem-centre">
        <p id="content">
            <span class="one-line-poem-name" title="subliminal dev team | 0/0/2022">[dev team]</span> If you can see this, the one line at a time poem is down. <br>
        </p>
        <div style="display: grid; grid-template-columns: min-content auto; column-gap: 2px;">
            <input id="name" type="text" placeholder="name" oninput="onNameInput(value)" size="4"/>
            <input id="poem-line" type="text" placeholder="+ poem line" oninput="onPoemLineInput(value)" size="55"/> <br>
        </div>
        <button onclick="postLine()">Add Line</button>
        <p id="status-label"></p>
    </div>
    <a href="../contents" class="back"> <- Back</a>
</body>
 
</html> 
